{"version":3,"file":"QuickPostWidget.js","mappings":"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","sources":["webpack:///./QuickPostWidget.js"],"sourcesContent":["(function ($) {\n  /** global: Craft */\n  /** global: Garnish */\n  Craft.QuickPostWidget = Garnish.Base.extend({\n    params: null,\n    formHtml: null,\n    $widget: null,\n    $form: null,\n    $saveBtn: null,\n    $errorList: null,\n    loading: false,\n\n    init: function (widgetId, params, formHtml) {\n      this.params = params;\n      this.formHtml = formHtml;\n      this.$widget = $('#widget' + widgetId);\n\n      this.initForm(this.$widget.find('form:first'));\n    },\n\n    initForm: function ($form) {\n      this.$form = $form;\n      this.$saveBtn = this.$form.find('button[type=submit]');\n\n      const $menuBtn = this.$form.find('> .buttons > .btngroup > .menubtn'),\n        $saveAndContinueEditingBtn = $menuBtn\n          .data('trigger')\n          .$container.find('> ul > li > a');\n\n      this.addListener(this.$form, 'submit', 'handleFormSubmit');\n      this.addListener(\n        $saveAndContinueEditingBtn,\n        'click',\n        'saveAndContinueEditing'\n      );\n\n      this.addListener($saveAndContinueEditingBtn, 'keydown', (event) => {\n        if (\n          event.keyCode === Garnish.SPACE_KEY ||\n          event.keyCode === Garnish.RETURN_KEY\n        ) {\n          event.preventDefault();\n          this.saveAndContinueEditing();\n        }\n      });\n    },\n\n    handleFormSubmit: function (event) {\n      event.preventDefault();\n\n      this.save(this.onSave.bind(this));\n    },\n\n    saveAndContinueEditing: function () {\n      this.save(this.gotoEntry.bind(this));\n    },\n\n    save: function (callback) {\n      if (this.loading) {\n        return;\n      }\n\n      this.loading = true;\n      this.$saveBtn.addClass('loading');\n\n      var formData = Garnish.getPostData(this.$form),\n        data = $.extend({enabled: 1}, formData, this.params);\n\n      // Stick with postActionRequest() for now, which handles the post data in this format better than sendActionRequest().\n      Craft.postActionRequest(\n        'entries/save-entry',\n        data,\n        (response, textStatus) => {\n          this.loading = false;\n          this.$saveBtn.removeClass('loading');\n\n          if (this.$errorList) {\n            this.$errorList.children().remove();\n          }\n\n          if (textStatus === 'success') {\n            Craft.cp.displaySuccess(Craft.t('app', 'Entry saved.'), {\n              details: response.elementHtml,\n            });\n            callback(response);\n          } else {\n            Craft.cp.displayError(Craft.t('app', 'Couldn’t save entry.'));\n\n            if (response && response.errors) {\n              if (!this.$errorList) {\n                this.$errorList = $('<ul class=\"errors\"/>').insertAfter(\n                  this.$form\n                );\n              }\n\n              for (var attribute in response.errors) {\n                if (!response.errors.hasOwnProperty(attribute)) {\n                  continue;\n                }\n\n                for (var i = 0; i < response.errors[attribute].length; i++) {\n                  var error = response.errors[attribute][i];\n                  $('<li/>', {\n                    text: error,\n                  }).appendTo(this.$errorList);\n                }\n              }\n            }\n          }\n        }\n      );\n    },\n\n    onSave: function (response) {\n      // Reset the widget\n      var $newForm = $(this.formHtml);\n      this.$form.replaceWith($newForm);\n      Craft.initUiElements($newForm);\n      this.initForm($newForm);\n\n      // Are there any Recent Entries widgets to notify?\n      if (typeof Craft.RecentEntriesWidget !== 'undefined') {\n        for (var i = 0; i < Craft.RecentEntriesWidget.instances.length; i++) {\n          var widget = Craft.RecentEntriesWidget.instances[i];\n          if (\n            !widget.params.sectionId ||\n            widget.params.sectionId == this.params.sectionId\n          ) {\n            widget.addEntry({\n              url: response.cpEditUrl,\n              title: response.title,\n              dateCreated: response.dateCreated,\n              username: response.authorUsername,\n            });\n          }\n        }\n      }\n    },\n\n    gotoEntry: function (response) {\n      // Redirect to the entry’s edit URL\n      Craft.redirectTo(response.cpEditUrl);\n    },\n  });\n})(jQuery);\n"],"names":["$","jQuery","Craft","QuickPostWidget","Garnish","Base","extend","params","formHtml","$widget","$form","$saveBtn","$errorList","loading","init","widgetId","this","initForm","find","_this","$saveAndContinueEditingBtn","data","$container","addListener","event","keyCode","SPACE_KEY","RETURN_KEY","preventDefault","saveAndContinueEditing","handleFormSubmit","save","onSave","bind","gotoEntry","callback","_this2","addClass","formData","getPostData","enabled","postActionRequest","response","textStatus","removeClass","children","remove","cp","displaySuccess","t","details","elementHtml","displayError","errors","attribute","insertAfter","hasOwnProperty","i","length","error","text","appendTo","$newForm","replaceWith","initUiElements","RecentEntriesWidget","instances","widget","sectionId","addEntry","url","cpEditUrl","title","dateCreated","username","authorUsername","redirectTo"],"sourceRoot":""}