!function(){var t={881:function(){},84:function(t,e,n){var i=n(881);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,n(673).Z)("81d37080",i,!0,{})},673:function(t,e,n){"use strict";function i(t,e){for(var n=[],i={},s=0;s<e.length;s++){var r=e[s],o=r[0],a={id:t+":"+s,css:r[1],media:r[2],sourceMap:r[3]};i[o]?i[o].parts.push(a):n.push(i[o]={id:o,parts:[a]})}return n}n.d(e,{Z:function(){return p}});var s="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!s)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var r={},o=s&&(document.head||document.getElementsByTagName("head")[0]),a=null,u=0,l=!1,h=function(){},d=null,c="data-vue-ssr-id",f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function p(t,e,n,s){l=n,d=s||{};var o=i(t,e);return m(o),function(e){for(var n=[],s=0;s<o.length;s++){var a=o[s];(u=r[a.id]).refs--,n.push(u)}for(e?m(o=i(t,e)):o=[],s=0;s<n.length;s++){var u;if(0===(u=n[s]).refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete r[u.id]}}}}function m(t){for(var e=0;e<t.length;e++){var n=t[e],i=r[n.id];if(i){i.refs++;for(var s=0;s<i.parts.length;s++)i.parts[s](n.parts[s]);for(;s<n.parts.length;s++)i.parts.push(w(n.parts[s]));i.parts.length>n.parts.length&&(i.parts.length=n.parts.length)}else{var o=[];for(s=0;s<n.parts.length;s++)o.push(w(n.parts[s]));r[n.id]={id:n.id,refs:1,parts:o}}}}function g(){var t=document.createElement("style");return t.type="text/css",o.appendChild(t),t}function w(t){var e,n,i=document.querySelector("style["+c+'~="'+t.id+'"]');if(i){if(l)return h;i.parentNode.removeChild(i)}if(f){var s=u++;i=a||(a=g()),e=$.bind(null,i,s,!1),n=$.bind(null,i,s,!0)}else i=g(),e=y.bind(null,i),n=function(){i.parentNode.removeChild(i)};return e(t),function(i){if(i){if(i.css===t.css&&i.media===t.media&&i.sourceMap===t.sourceMap)return;e(t=i)}else n()}}var v,b=(v=[],function(t,e){return v[t]=e,v.filter(Boolean).join("\n")});function $(t,e,n,i){var s=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=b(e,s);else{var r=document.createTextNode(s),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(r,o[e]):t.appendChild(r)}}function y(t,e){var n=e.css,i=e.media,s=e.sourceMap;if(i&&t.setAttribute("media",i),d.ssrId&&t.setAttribute(c,e.id),s&&(n+="\n/*# sourceURL="+s.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var r=e[i]={id:i,exports:{}};return t[i](r,r.exports,n),r.exports}n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){"use strict";function t(){return void 0!==(null===window||void 0===window?void 0:window.PublicKeyCredential)&&"function"==typeof window.PublicKeyCredential}n(84);class e extends Error{constructor(t,e="WebAuthnError"){super(t),this.name=e}}var i,s,r;new class{createNewAbortSignal(){this.controller&&this.controller.abort("Cancelling existing WebAuthn API call for new one");const t=new AbortController;return this.controller=t,t.signal}},i=jQuery,s=Garnish.Base.extend({$loginDiv:null,$form:null,$loginNameInput:null,$passwordInput:null,$rememberMeCheckbox:null,$forgotPasswordLink:null,$rememberPasswordLink:null,$alternativeLoginLink:null,$submitBtn:null,$errors:null,forgotPassword:!1,loginWithPassword:!1,loginWithSecurityKey:!1,validateOnInput:!1,mfaFlow:!1,mfa:null,init:function(){var e=this;this.$loginDiv=i("#login"),this.$form=i("#login-form"),this.$loginNameInput=i("#loginName"),this.$passwordInput=i("#password"),this.$rememberMeCheckbox=i("#rememberMe"),this.$forgotPasswordLink=i("#forgot-password"),this.$rememberPasswordLink=i("#remember-password"),this.$submitBtn=i("#submit"),this.$errors=i("#login-errors"),this.$submitBtn=new Garnish.MultiFunctionBtn(this.$submitBtn,{changeButtonText:!0}),new Craft.PasswordInput(this.$passwordInput,{onToggleInput:function(t){e.removeListener(e.$passwordInput,"input"),e.$passwordInput=t,e.addListener(e.$passwordInput,"input","onInput")}}),t()||(this.loginWithPassword=!0),this.loginWithPassword||this.loginWithSecurityKey||(this.$passwordInput.hide(),this.$forgotPasswordLink.hide(),this.$rememberMeCheckbox.parents(".field").hide(),this.$submitBtn.updateMessages(Craft.t("app","Continue"))),this.addListener(this.$loginNameInput,"input","onInput"),this.addListener(this.$passwordInput,"input","onInput"),this.addListener(this.$forgotPasswordLink,"click","onSwitchForm"),this.addListener(this.$rememberPasswordLink,"click","onSwitchForm"),this.addListener(this.$form,"submit","onSubmit"),Garnish.isMobileBrowser()||(this.$loginNameInput.val()?this.$passwordInput.focus():this.$loginNameInput.focus())},validate:function(){var t=this.$loginNameInput.val();if(0===t.length)return window.useEmailAsUsername?Craft.t("app","Invalid email."):Craft.t("app","Invalid username or email.");if(window.useEmailAsUsername&&!t.match(".+@.+..+"))return Craft.t("app","Invalid email.");if(!this.forgotPassword&&this.loginWithPassword){var e=this.$passwordInput.val().length;if(e<window.minPasswordLength)return Craft.t("yii","{attribute} should contain at least {min, number} {min, plural, one{character} other{characters}}.",{attribute:Craft.t("app","Password"),min:window.minPasswordLength});if(e>window.maxPasswordLength)return Craft.t("yii","{attribute} should contain at most {max, number} {max, plural, one{character} other{characters}}.",{attribute:Craft.t("app","Password"),max:window.maxPasswordLength})}return!0},onInput:function(t){this.validateOnInput&&!0===this.validate()&&this.clearErrors()},onSubmit:function(t){t.preventDefault();var e=this.validate();if(!0!==e)return this.showError(e),void(this.validateOnInput=!0);this.$submitBtn.busyEvent(),this.clearErrors(),this.forgotPassword?this.submitForgotPassword():this.loginWithSecurityKey?this.webauthnLogin():this.mfaFlow?this.submitMfaCode():this.loginWithPassword?this.submitLogin():this.submitFindUser()},submitFindUser:function(){var e=this,n={loginName:this.$loginNameInput.val()};return Craft.sendActionRequest("POST","users/get-user-for-login",{data:n}).then((function(n){t()&&void 0!==n.data.hasSecurityKeys&&1==n.data.hasSecurityKeys?(e.loginWithSecurityKey=!0,e.$rememberMeCheckbox.parents(".field").show(),e.$submitBtn.updateMessages(Craft.t("app","Sign in with a security key")),null===e.$alternativeLoginLink&&(i("#login-form-extra").remove("#alternative-login").prepend('<button id="alternative-login" type="button" class="btn">'+Craft.t("app","Use password to login")+"</button>"),e.$alternativeLoginLink=i("#alternative-login"),e.addListener(e.$alternativeLoginLink,"click","onAlternativeLoginLink"))):(e.loginWithPassword=!0,e.$passwordInput.show(),e.$forgotPasswordLink.show(),e.$rememberMeCheckbox.parents(".field").show(),e.$submitBtn.updateMessages(Craft.t("app","Sign in")),e.mfa=new Craft.Auth2fa)})).catch((function(t){var n=t.response;e.processFailure(n.data.message)})).finally((function(){e.$submitBtn.endBusyState()})),!1},submitForgotPassword:function(){var t=this,e={loginName:this.$loginNameInput.val()};Craft.sendActionRequest("POST","users/send-password-reset-email",{data:e}).then((function(t){new r})).catch((function(e){var n=e.response;t.showError(n.data.message)}))},webauthnLogin:function(){var t=this;this.clearErrors(),this.$submitBtn.busyEvent();var e={loginName:this.$loginNameInput.val(),rememberMe:this.$rememberMeCheckbox.prop("checked")?"y":""};new Craft.Auth2faLogin.startWebauthnLogin(e,!1).then((function(e){t.$submitBtn.successEvent(),null!=e.returnUrl&&(window.location.href=e.returnUrl)})).catch((function(e){t.processFailure(e.error)}))},submitMfaCode:function(){var t=this;this.clearErrors(),this.$submitBtn.busyEvent(),new Craft.Auth2faLogin.submitMfaCode(i("#mfa-form"),!1).then((function(e){t.$submitBtn.successEvent(),window.location.href=e.returnUrl})).catch((function(e){t.processFailure(e.message)}))},submitLogin:function(){var t=this;this.clearErrors(),this.$submitBtn.busyEvent();var e={loginName:this.$loginNameInput.val(),password:this.$passwordInput.val(),rememberMe:this.$rememberMeCheckbox.prop("checked")?"y":""};return Craft.sendActionRequest("POST","users/login",{data:e}).then((function(e){void 0!==e.data.mfa&&1==e.data.mfa?(t.mfaFlow=!0,null!==t.$alternativeLoginLink&&t.$alternativeLoginLink.remove(),t.mfa.showMfaForm(e.data.mfaForm,t.$loginDiv),t.$submitBtn.endBusyState()):(t.$submitBtn.successEvent(),window.location.href=e.data.returnUrl)})).catch((function(e){var n=e.response;t.processFailure(n.data.message)})),!1},processFailure:function(t){Garnish.shake(this.$form,"left"),this.onSubmitResponse(),this.showError(t),this.$submitBtn.failureEvent()},onSubmitResponse:function(){this.$submitBtn.failureEvent()},showError:function(t){this.clearErrors(),i('<p style="display: none;">'+t+"</p>").appendTo(this.$errors).velocity("fadeIn")},clearErrors:function(){this.$errors.empty()},onSwitchForm:function(t){Garnish.isMobileBrowser()||this.$loginNameInput.trigger("focus"),this.clearErrors(),this.forgotPassword=!this.forgotPassword,this.$form.toggleClass("reset-password",this.forgotPassword),this.$submitBtn.updateMessages(Craft.t("app",this.forgotPassword?"Reset Password":"Sign in"))},onAlternativeLoginLink:function(t){Garnish.isMobileBrowser()||this.$loginNameInput.trigger("focus"),this.clearErrors(),this.loginWithPassword=!this.loginWithPassword,this.loginWithSecurityKey=!this.loginWithSecurityKey,this.$passwordInput.toggle(),this.$forgotPasswordLink.toggle(),this.loginWithPassword?(this.$submitBtn.updateMessages(Craft.t("app","Sign in")),this.$alternativeLoginLink.text(Craft.t("app","Use a security key to login")),this.mfa=new Craft.Auth2fa):this.loginWithSecurityKey&&(this.$submitBtn.updateMessages(Craft.t("app","Sign in using a security key")),this.$alternativeLoginLink.text(Craft.t("app","Use a password to login")))}}),r=Garnish.Modal.extend({init:function(){var t=i('<div class="modal fitted email-sent"><div class="body">'+Craft.t("app","Check your email for instructions to reset your password.")+"</div></div>").appendTo(Garnish.$bod);this.base(t)},hide:function(){}}),new s}()}();
//# sourceMappingURL=login.js.map